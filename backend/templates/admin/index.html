{% extends "admin/base_site.html" %}
{% load i18n %}

{% block breadcrumbs %}{% endblock %}

{% block content %}
<div style="padding: 20px;">
    <!-- Welcome Section with Server Time -->
    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
                <h1 style="font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #111827;">
                    Welcome to Codeteki Admin
                </h1>
                <p style="color: #6b7280;">
                    Manage your website content, CRM, email outreach, and more from the sidebar navigation.
                </p>
            </div>
            {% if server_time %}
            <div style="text-align: right; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 16px 24px; border-radius: 12px; min-width: 180px;">
                <p style="font-size: 12px; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Server Time (AEST)</p>
                <p style="font-size: 28px; font-weight: 700; color: #f9cb07; margin-bottom: 2px;">{{ server_time }}</p>
                <p style="font-size: 13px; color: #cbd5e1;">{{ server_date }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- CRM Stats Cards -->
    {% if crm_cards %}
    <div style="margin-bottom: 24px;">
        <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">CRM & Outreach</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            {% for card in crm_cards %}
            <a href="{{ card.url }}" style="text-decoration: none; display: block;">
                <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.transform='translateY(-2px)';"
                     onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)';">
                    <p style="font-size: 14px; color: #94a3b8; margin-bottom: 4px;">{{ card.title }}</p>
                    <p style="font-size: 32px; font-weight: 700; color: #f9cb07;">{{ card.value }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Pipeline Overview -->
    {% if pipeline_stats %}
    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2 style="font-size: 18px; font-weight: 600; color: #111827;">Active Pipelines</h2>
            <a href="/admin/crm/dashboard/" style="font-size: 13px; color: #f9cb07; text-decoration: none; font-weight: 500;">View All Pipelines</a>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            {% for pipeline in pipeline_stats %}
            <a href="{{ pipeline.url }}" style="text-decoration: none;">
                <div style="padding: 16px; background: #f9fafb; border-radius: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
                     onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                    <p style="font-weight: 600; color: #111827; margin-bottom: 4px;">{{ pipeline.name }}</p>
                    <p style="font-size: 24px; font-weight: 700; color: #f9cb07;">{{ pipeline.active_deals }}</p>
                    <p style="font-size: 12px; color: #6b7280;">active deals</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Website Stats Cards -->
    {% if cards %}
    <div style="margin-bottom: 24px;">
        <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Website Stats</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            {% for card in cards %}
            <a href="{{ card.url }}" style="text-decoration: none; display: block;">
                <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid #e5e7eb; cursor: pointer; transition: all 0.15s;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.boxShadow='0 4px 12px rgba(249,203,7,0.15)';"
                     onmouseout="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';">
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 4px;">{{ card.title }}</p>
                    <p style="font-size: 32px; font-weight: 700; color: #111827;">{{ card.value }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #111827;">Quick Actions</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
            <a href="{% url 'admin:crm_emaildraft_changelist' %}"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); text-decoration: none; color: #f9cb07; font-size: 14px; font-weight: 600; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.transform='translateY(-2px)';"
               onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)';">
                üìß Email Composer
            </a>
            <a href="/admin/crm/dashboard/"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); text-decoration: none; color: #f9cb07; font-size: 14px; font-weight: 600; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.transform='translateY(-2px)';"
               onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)';">
                üìä Pipeline Board
            </a>
            <a href="{% url 'admin:crm_contact_changelist' %}"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: #f9fafb; text-decoration: none; color: #374151; font-size: 14px; font-weight: 500; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
               onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                üë• All Contacts
            </a>
            <a href="{% url 'admin:crm_deal_changelist' %}"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: #f9fafb; text-decoration: none; color: #374151; font-size: 14px; font-weight: 500; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
               onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                ü§ù View Deals
            </a>
            <a href="{% url 'admin:core_siteaudit_changelist' %}"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: #f9fafb; text-decoration: none; color: #374151; font-size: 14px; font-weight: 500; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
               onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                üìà SEO Audits
            </a>
            <a href="{% url 'admin:core_sitesettings_changelist' %}"
               style="display: flex; align-items: center; gap: 8px; padding: 12px; border-radius: 8px; background: #f9fafb; text-decoration: none; color: #374151; font-size: 14px; font-weight: 500; transition: all 0.15s; border: 2px solid transparent;"
               onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
               onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                ‚öôÔ∏è Site Settings
            </a>
        </div>
    </div>

    <!-- Recent Activity Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
        <!-- Recent Deals -->
        {% if recent_deals %}
        <div style="background: white; border-radius: 12px; padding: 24px; border: 1px solid #e5e7eb;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="font-size: 18px; font-weight: 600; color: #111827;">Recent Deals</h2>
                <a href="{% url 'admin:crm_deal_changelist' %}" style="font-size: 13px; color: #f9cb07; text-decoration: none; font-weight: 500;">View All</a>
            </div>
            {% for deal in recent_deals %}
            <a href="{% url 'admin:crm_deal_change' deal.id %}" style="text-decoration: none; display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07';"
                     onmouseout="this.style.borderColor='transparent';">
                    <div style="overflow: hidden;">
                        <p style="font-weight: 500; color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ deal.contact_name }}</p>
                        <p style="font-size: 12px; color: #6b7280;">{{ deal.stage }} - {{ deal.updated_at|timesince }} ago</p>
                    </div>
                    <span style="padding: 4px 8px; font-size: 11px; font-weight: 500; border-radius: 9999px; white-space: nowrap;
                        {% if deal.status == 'active' %}background: #dcfce7; color: #166534;
                        {% elif deal.status == 'won' %}background: #dbeafe; color: #1e40af;
                        {% else %}background: #f3f4f6; color: #374151;{% endif %}">
                        {{ deal.status }}
                    </span>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Recent Leads -->
        <div style="background: white; border-radius: 12px; padding: 24px; border: 1px solid #e5e7eb;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="font-size: 18px; font-weight: 600; color: #111827;">Recent Leads</h2>
                <a href="{% url 'admin:core_chatlead_changelist' %}" style="font-size: 13px; color: #f9cb07; text-decoration: none; font-weight: 500;">View All</a>
            </div>
            {% for lead in recent_leads %}
            <a href="{% url 'admin:core_chatlead_change' lead.id %}" style="text-decoration: none; display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07';"
                     onmouseout="this.style.borderColor='transparent';">
                    <div>
                        <p style="font-weight: 500; color: #111827;">{{ lead.name }}</p>
                        <p style="font-size: 12px; color: #6b7280;">{{ lead.created_at|timesince }} ago</p>
                    </div>
                    <span style="padding: 4px 8px; font-size: 12px; font-weight: 500; border-radius: 9999px;
                        {% if lead.status == 'new' %}background: #dcfce7; color: #166534;{% else %}background: #f3f4f6; color: #374151;{% endif %}">
                        {{ lead.status }}
                    </span>
                </div>
            </a>
            {% empty %}
            <p style="color: #6b7280; font-size: 14px;">No recent leads</p>
            {% endfor %}
        </div>

        <!-- Recent Audits -->
        <div style="background: white; border-radius: 12px; padding: 24px; border: 1px solid #e5e7eb;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="font-size: 18px; font-weight: 600; color: #111827;">Recent Audits</h2>
                <a href="{% url 'admin:core_siteaudit_changelist' %}" style="font-size: 13px; color: #f9cb07; text-decoration: none; font-weight: 500;">View All</a>
            </div>
            {% for audit in recent_audits %}
            <a href="{% url 'admin:core_siteaudit_change' audit.pk %}" style="text-decoration: none; display: block;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07';"
                     onmouseout="this.style.borderColor='transparent';">
                    <div style="overflow: hidden;">
                        <p style="font-weight: 500; color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">{{ audit.url }}</p>
                        <p style="font-size: 12px; color: #6b7280;">{{ audit.created_at|timesince }} ago</p>
                    </div>
                    <span style="padding: 4px 8px; font-size: 12px; font-weight: 500; border-radius: 9999px;
                        {% if audit.status == 'completed' %}background: #dcfce7; color: #166534;
                        {% elif audit.status == 'running' %}background: #dbeafe; color: #1e40af;
                        {% else %}background: #f3f4f6; color: #374151;{% endif %}">
                        {{ audit.status }}
                    </span>
                </div>
            </a>
            {% empty %}
            <p style="color: #6b7280; font-size: 14px;">No recent audits</p>
            {% endfor %}
        </div>
    </div>

    <!-- Content Overview -->
    {% if content_stats %}
    <div style="background: white; border-radius: 12px; padding: 24px; margin-top: 24px; border: 1px solid #e5e7eb;">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #111827;">Content Overview</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; text-align: center;">
            <a href="{% url 'admin:core_service_changelist' %}" style="text-decoration: none;">
                <div style="padding: 16px; background: #f9fafb; border-radius: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
                     onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                    <p style="font-size: 24px; font-weight: 700; color: #f9cb07;">{{ content_stats.services }}</p>
                    <p style="font-size: 14px; color: #6b7280;">Services</p>
                </div>
            </a>
            <a href="{% url 'admin:core_herosection_changelist' %}" style="text-decoration: none;">
                <div style="padding: 16px; background: #f9fafb; border-radius: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
                     onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                    <p style="font-size: 24px; font-weight: 700; color: #f9cb07;">{{ content_stats.hero_sections }}</p>
                    <p style="font-size: 14px; color: #6b7280;">Active Hero Sections</p>
                </div>
            </a>
            <a href="{% url 'admin:core_testimonial_changelist' %}" style="text-decoration: none;">
                <div style="padding: 16px; background: #f9fafb; border-radius: 8px; cursor: pointer; transition: all 0.15s; border: 2px solid transparent;"
                     onmouseover="this.style.borderColor='#f9cb07'; this.style.background='#fffbeb';"
                     onmouseout="this.style.borderColor='transparent'; this.style.background='#f9fafb';">
                    <p style="font-size: 24px; font-weight: 700; color: #f9cb07;">{{ content_stats.testimonials }}</p>
                    <p style="font-size: 14px; color: #6b7280;">Testimonials</p>
                </div>
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
